<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>ग्राम पंचायत सर्वा · उन्नत डैशबोर्ड</title>
  <!-- फॉन्ट और आइकन -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- चार्ट.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #f4f7fc;
      padding: 24px 16px;
      color: #1d2b3f;
      line-height: 1.5;
      transition: background-color 0.3s, color 0.3s;
    }

    /* डार्क मोड */
    body.dark-mode {
      background: #0b1321;
      color: #e5e9f0;
    }
    body.dark-mode .masthead {
      background: #0f1a2b;
      border-color: #2a3b4e;
    }
    body.dark-mode .control-ribbon,
    body.dark-mode .finance-summary,
    body.dark-mode .chart-card,
    body.dark-mode .table-section,
    body.dark-mode .excellence-footer {
      background: #1a2637;
      border-color: #31445c;
      color: #e0e7f5;
    }
    body.dark-mode .search-module {
      background: #263445;
      border-color: #405974;
    }
    body.dark-mode .search-module input {
      color: white;
    }
    body.dark-mode .pill {
      background: #263445;
      color: #b5c9f0;
    }
    body.dark-mode .pill.active {
      background: #3b6bb0;
      color: white;
    }
    body.dark-mode .legend-item,
    body.dark-mode .quick-stats,
    body.dark-mode .stat-row {
      background: #1f2d40;
      color: #d3def5;
    }
    body.dark-mode th {
      background: #25344a;
      color: #f0f4fe;
    }
    body.dark-mode td {
      border-bottom-color: #33455e;
    }
    body.dark-mode .badge {
      background: #2f5580;
    }
    body.dark-mode .donut {
      background: #1e3146;
      border-color: #3b5f85;
      border-top-color: #6da5e6;
    }

    .flagship-dashboard {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* एनिमेशन */
    @keyframes gentleRise {
      0% { opacity: 0; transform: translateY(18px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .masthead, .control-ribbon, .insight-panel, .table-section, .excellence-footer {
      animation: gentleRise 0.6s ease forwards;
    }

    /* === हेडर === */
    .masthead {
      background: linear-gradient(145deg, #0b2b44, #123b5e);
      border-radius: 40px;
      padding: 28px 26px;
      box-shadow: 0 25px 35px -18px #0b2b4460;
      border: 1px solid #ffffff30;
      color: white;
      transition: background 0.3s;
    }
    .brand-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
    }
    .insignia {
      display: flex;
      align-items: center;
      gap: 18px;
    }
    .gov-icon {
      background: #ffffff18;
      backdrop-filter: blur(5px);
      width: 64px;
      height: 64px;
      border-radius: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: #ffd58c;
      border: 2px solid #ffffff40;
    }
    .gov-title h1 {
      font-weight: 700;
      font-size: 1.9rem;
      background: linear-gradient(135deg, #fff2d4, #ffd58c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 6px;
      letter-spacing: -0.02em;
    }
    .gov-title .sub {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      font-size: 0.9rem;
      opacity: 0.85;
    }
    .commission-tag {
      background: #ffffff1a;
      border-radius: 60px;
      padding: 10px 24px;
      font-weight: 500;
      border: 1px solid #ffffff70;
      backdrop-filter: blur(5px);
      cursor: pointer;
      transition: 0.2s;
    }
    .commission-tag:hover {
      background: #ffffff30;
    }

    /* मेट्रिक्स कार्ड */
    .gold-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 18px;
      margin-top: 32px;
    }
    .metric-gold {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,240,180,0.25);
      border-radius: 32px;
      padding: 20px 14px;
      display: flex;
      align-items: center;
      gap: 14px;
      transition: 0.25s;
    }
    .metric-gold:hover {
      background: rgba(255,255,255,0.15);
      border-color: #fec97a;
      transform: translateY(-4px);
    }
    .metric-icon {
      font-size: 2rem;
      background: #ffffff15;
      width: 56px;
      height: 56px;
      border-radius: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .metric-content h2 {
      font-size: 1.8rem;
      font-weight: 800;
      line-height: 1.2;
    }
    .metric-content p {
      font-size: 0.7rem;
      text-transform: uppercase;
      opacity: 0.8;
      letter-spacing: 0.4px;
    }

    /* कंट्रोल रिबन */
    .control-ribbon {
      background: white;
      border-radius: 60px;
      padding: 12px 24px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      border: 1px solid #dbe3ed;
      box-shadow: 0 8px 16px -12px #132e46;
      transition: background 0.3s;
    }
    .search-module {
      display: flex;
      align-items: center;
      background: #f0f5fd;
      border-radius: 50px;
      padding: 10px 22px;
      min-width: 260px;
      flex: 1 1 260px;
      border: 1px solid #c0d2e8;
      transition: 0.2s;
    }
    .search-module i {
      color: #316797;
      margin-right: 12px;
    }
    .search-module input {
      border: none;
      background: transparent;
      font-size: 0.95rem;
      width: 100%;
      outline: none;
    }
    .filter-pills {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .pill {
      background: #eef4fb;
      border: none;
      padding: 10px 20px;
      border-radius: 40px;
      font-weight: 600;
      font-size: 0.85rem;
      color: #1e4062;
      cursor: pointer;
      transition: 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .pill.active {
      background: #1e4f7a;
      color: white;
    }
    #yearFilter {
      background: #eef4fb;
      border: none;
      padding: 10px 26px 10px 18px;
      border-radius: 40px;
      font-weight: 600;
      font-size: 0.85rem;
      color: #1e4062;
      cursor: pointer;
      outline: none;
    }

    /* इनसाइट पैनल */
    .insight-panel {
      display: grid;
      grid-template-columns: 1.2fr 2fr;
      gap: 22px;
    }
    .finance-summary {
      background: white;
      border-radius: 36px;
      padding: 24px 22px;
      box-shadow: 0 20px 35px -18px #14395640;
      border: 1px solid #d5e2f0;
      transition: background 0.3s;
    }
    .summary-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 18px;
      flex-wrap: wrap;
      gap: 8px;
      font-weight: 600;
    }
    .donut-progress {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 15px;
    }
    .donut {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #f9fcff, #d6e4f5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 2.2rem;
      color: #02457a;
      border: 8px solid #c7dfff;
      border-top-color: #1f6eb0;
      margin: 0 auto 10px;
      transition: background 0.3s;
    }
    .legend-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #f6faff;
      padding: 12px 14px;
      border-radius: 26px;
      font-weight: 500;
    }
    .color-dot {
      width: 16px;
      height: 16px;
      border-radius: 20px;
      display: inline-block;
    }
    .quick-stats {
      background: #e9f1fa;
      border-radius: 28px;
      padding: 16px 18px;
      margin: 16px 0;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px dashed #a5bed9;
      padding: 10px 0;
    }
    .progress-micro-bar {
      background: #d9e2ef;
      height: 16px;
      border-radius: 40px;
      overflow: hidden;
    }
    .progress-fill {
      background: #1e6eb5;
      height: 16px;
      width: 0%;
      border-radius: 40px;
      transition: width 0.4s;
    }

    /* चार्ट कार्ड */
    .chart-card {
      background: white;
      border-radius: 36px;
      padding: 24px 22px;
      border: 1px solid #d5e2f0;
      box-shadow: 0 20px 30px -16px #14365330;
      transition: background 0.3s;
    }
    canvas#yearChart {
      max-height: 210px;
      width: 100% !important;
    }

    /* टेबल सेक्शन */
    .table-section {
      background: white;
      border-radius: 36px;
      padding: 6px;
      border: 1px solid #ccddec;
      box-shadow: 0 10px 20px -10px #15365330;
      transition: background 0.3s;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px 10px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .table-header h2 {
      font-weight: 700;
      font-size: 1.6rem;
    }
    .badge {
      background: #1f4b73;
      color: white;
      padding: 8px 22px;
      border-radius: 50px;
      font-weight: 600;
    }
    .table-scroll {
      overflow-x: auto;
      border-radius: 30px;
      -webkit-overflow-scrolling: touch;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      min-width: 1300px;
    }
    th {
      background: #1f4b73;
      color: white;
      padding: 18px 12px;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }
    th i {
      margin-left: 6px;
      font-size: 0.8rem;
    }
    td {
      padding: 16px 12px;
      border-bottom: 1px solid #e2ecf7;
      vertical-align: middle;
    }
    td:first-child, th:first-child { padding-left: 20px; }
    td:last-child, th:last-child { padding-right: 20px; }
    tbody tr:hover td {
      background: #f2f9ff;
    }
    .status-super {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 18px;
      border-radius: 40px;
      font-weight: 600;
      font-size: 0.75rem;
      border: 1px solid;
      white-space: nowrap;
    }
    .status-super.complete {
      background: #e1f3e8;
      color: #0e6b47;
      border-color: #aadbbc;
    }
    .status-super.progress {
      background: #ffefdb;
      color: #b65118;
      border-color: #fad49c;
    }
    tfoot {
      background: #e9f0f9;
    }
    .grand-total-amt {
      font-size: 1.1rem;
      font-weight: 800;
    }
    .rupee-cell {
      text-align: right;
      font-weight: 600;
    }

    /* फुटर */
    .excellence-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      border-radius: 50px;
      padding: 18px 28px;
      border: 1px solid #c6d7eb;
      flex-wrap: wrap;
      gap: 16px;
    }
    .footer-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn-icon {
      background: #1d4f7c;
      color: white;
      border: none;
      padding: 10px 22px;
      border-radius: 40px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: 0.2s;
    }
    .btn-icon:hover {
      background: #0f3b5e;
      transform: scale(1.02);
    }

    @media (max-width: 1000px) {
      .insight-panel { grid-template-columns: 1fr; }
    }
    @media (max-width: 700px) {
      .gold-stats { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 500px) {
      .gold-stats { grid-template-columns: 1fr; }
      .gov-title h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
<div class="flagship-dashboard" id="app">

  <!-- हेडर (नया आइकन) -->
  <div class="masthead">
    <div class="brand-row">
      <div class="insignia">
        <div class="gov-icon"><i class="fas fa-university"></i></div>
        <div class="gov-title">
          <h1>15वीं वित्त + षष्टम राज्य वित्त</h1>
          <div class="sub">
            <span><i class="fas fa-map-pin"></i> सर्वा | बरबीघा | शेखपुरा</span>
            <span><i class="fas fa-calendar-alt"></i> 2025-26</span>
          </div>
        </div>
      </div>
      <div class="commission-tag" onclick="toggleDarkMode()">
        <i class="fas fa-moon"></i> डार्क मोड
      </div>
    </div>

    <!-- मेट्रिक्स -->
    <div class="gold-stats" id="metricCards">
      <div class="metric-gold"><span class="metric-icon"><i class="fas fa-tasks"></i></span><div class="metric-content"><h2 id="totalSchemes">0</h2><p>कुल योजनाएँ</p></div></div>
      <div class="metric-gold"><span class="metric-icon"><i class="fas fa-check-circle"></i></span><div class="metric-content"><h2 id="completedSchemes">0</h2><p>पूर्ण कार्य</p></div></div>
      <div class="metric-gold"><span class="metric-icon"><i class="fas fa-spinner"></i></span><div class="metric-content"><h2 id="progressSchemes">0</h2><p>प्रगति पर</p></div></div>
      <div class="metric-gold"><span class="metric-icon"><i class="fas fa-coins"></i></span><div class="metric-content"><h2 id="totalAmount">₹0</h2><p>कुल परिव्यय</p></div></div>
    </div>
  </div>

  <!-- कंट्रोल रिबन -->
  <div class="control-ribbon">
    <div class="search-module">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="कार्य खोजें (नाम/मद)..." id="searchInput">
    </div>
    <div class="filter-pills" id="filterPills">
      <button class="pill active" data-filter="all"><i class="fas fa-layer-group"></i> सभी</button>
      <button class="pill" data-filter="complete"><i class="fas fa-check"></i> पूर्ण</button>
      <button class="pill" data-filter="progress"><i class="fas fa-clock"></i> प्रगति पर</button>
      <select id="yearFilter" class="pill" style="background:#eef4fb; padding:8px 18px;">
        <option value="all">सभी वर्ष</option>
        <option value="2021–22">2021–22</option>
        <option value="2022–23">2022–23</option>
        <option value="2023–24">2023–24</option>
        <option value="2024–25">2024–25</option>
        <option value="2024–2025">2024–2025</option>
        <option value="2025–26">2025–26</option>
      </select>
    </div>
  </div>

  <!-- इनसाइट + चार्ट -->
  <div class="insight-panel">
    <div class="finance-summary">
      <div class="summary-header"><h3><i class="fas fa-chart-pie"></i> निष्पादन</h3><span id="completionPercentBadge">0%</span></div>
      <div class="donut-progress">
        <div class="donut" id="donutPercent">0%</div>
        <span id="completionFraction">0/0</span>
      </div>
      <div class="legend-grid">
        <div class="legend-item"><span class="color-dot" style="background:#1f8b4c;"></span> पूर्ण: <span id="legendComplete">0</span></div>
        <div class="legend-item"><span class="color-dot" style="background:#de9b45;"></span> प्रगति: <span id="legendProgress">0</span></div>
      </div>
      <div class="quick-stats" id="quickStats"></div>
      <div style="margin-top:16px;"><div class="progress-micro-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div></div>
    </div>

    <div class="chart-card">
      <div class="summary-header"><h3><i class="fas fa-chart-bar"></i> वित्त वर्षानुसार कार्य</h3></div>
      <canvas id="yearChart"></canvas>
    </div>
  </div>

  <!-- 15वीं वित्त आयोग -->
  <div class="table-section">
    <div class="table-header">
      <h2><i class="fas fa-landmark"></i> 15वीं वित्त आयोग</h2>
      <div class="badge" id="badge15">0 कार्य</div>
    </div>
    <div class="table-scroll">
      <table id="table15">
        <thead><tr><th onclick="sortTable(0, '15')">क्र. <i class="fas fa-sort"></i></th><th onclick="sortTable(1, '15')">मद <i class="fas fa-sort"></i></th><th onclick="sortTable(2, '15')">वित्त वर्ष <i class="fas fa-sort"></i></th><th onclick="sortTable(3, '15')">योजना का नाम <i class="fas fa-sort"></i></th><th onclick="sortTable(4, '15')">राशि <i class="fas fa-sort"></i></th><th>स्थिति</th></tr></thead>
        <tbody id="table15Body"></tbody>
        <tfoot><tr><td colspan="5" class="grand-total-label">कुल</td><td class="rupee-cell grand-total-amt" id="footer15Total">₹0</td></tr></tfoot>
      </table>
    </div>
  </div>

  <!-- षष्टम राज्य वित्त -->
  <div class="table-section">
    <div class="table-header">
      <h2><i class="fas fa-building"></i> षष्टम राज्य वित्त</h2>
      <div class="badge" id="badgeState">0 कार्य</div>
    </div>
    <div class="table-scroll">
      <table id="tableState">
        <thead><tr><th onclick="sortTable(0, 'state')">क्र. <i class="fas fa-sort"></i></th><th onclick="sortTable(1, 'state')">मद <i class="fas fa-sort"></i></th><th onclick="sortTable(2, 'state')">वित्त वर्ष <i class="fas fa-sort"></i></th><th onclick="sortTable(3, 'state')">योजना का नाम <i class="fas fa-sort"></i></th><th onclick="sortTable(4, 'state')">राशि <i class="fas fa-sort"></i></th><th>स्थिति</th></tr></thead>
        <tbody id="tableStateBody"></tbody>
        <tfoot><tr><td colspan="5" class="grand-total-label">कुल</td><td class="rupee-cell grand-total-amt" id="footerStateTotal">₹0</td></tr></tfoot>
      </table>
    </div>
  </div>

  <!-- फुटर -->
  <div class="excellence-footer">
    <div><i class="fas fa-check-double"></i> पंचायत सर्वा · 24 फरवरी 2026</div>
    <div class="footer-actions">
      <button class="btn-icon" onclick="exportCSV()"><i class="fas fa-file-csv"></i> CSV</button>
      <button class="btn-icon" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
      <button class="btn-icon" onclick="window.print()"><i class="fas fa-print"></i> प्रिंट</button>
    </div>
  </div>
</div>

<script>
  // ---------- समस्त डेटा (ज्यों का त्यों) ----------
  const schemes = [
    // 15वीं वित्त (24)
    { fund: "15वीं वित्त आयोग", year: "2021–22", desc: "ग्राम पंचायत सर्वा के ग्राम सर्वा के वार्षिक सं0–07 में बौद्धी पोखर के चारों तरफ मिट्टी भराई एवं खरंजीकरण कार्य।", amount: 1096700, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2021–22", desc: "ग्राम पंचायत सर्वा के ग्राम सर्वा में परमेश्वर साथ से सिभेक्षण महत्ता तक पीठसी0सी0 ढलाई कार्य।", amount: 319100, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2022–23", desc: "ग्राम सर्वा में गेट्टीनी पैन पुल से चादीपुर तक पैन सफाई का मिनांग कार्य।", amount: 1156700, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के ग्राम जमालपुर के वार्षिक सं0–12 में अर्जुन पंडित के घर से विद्रोह कर मांडी के घर तक नाली ढक्कन सहित मिनांग कार्य।", amount: 831000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के ग्राम सर्वा बौद्धी पोखर पर खुला जिम्न का मिनांग कार्य।", amount: 500000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के वार्षिक सं0–06 एवं 07 में महेन्द्र सिंह के घर से ओमन सिंह के घर तक नाली एवं पीठसी0सी0 ढलाई कार्य।", amount: 585800, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा में डस्टवीन 2684 घर के लिए 180 रूपये प्रति जोड़ा।", amount: 500000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम पंचायत सर्वा के वार्षिक सं0–09 में हरगोबिंद यादव के निकट सार्वजनिक कुर्आ का जीणीढ़ार का कार्य।", amount: 74300, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम पंचायत सर्वा के वार्षिक सं0–11 में अजीत पासवान के घर के निकट कुर्आ का जीणीढ़ार का कार्य।", amount: 74300, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम पंचायत सर्वा में किसान भवन पर वर्षा जल संचयन का कार्य।", amount: 110000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम पंचायत सर्वा के ग्राम मिर्जापुर के वार्षिक सं0–05 में अशोक सिह के घर से जनहित पुस्तकालय तक ढक्कन सहित नाली एवं पीठसी0सी0 ढलाई कार्य।", amount: 705000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम पंचायत सर्वा के ग्राम राजीरा के वार्षिक सं0–01 में चम्पक पासवान के घर से नगीना पासवान के घर तक ढक्कन सहित नाली एवं पीठसी0सी0 सड़क का निर्माण कार्य।", amount: 545300, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम राजीरा के वार्षिक सं0–04 के अनुसूचित टोला में सामुदायिक भवन का निर्माण कार्य।", amount: 800000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2023–24", desc: "ग्राम राजीरा के वार्षिक सं0–02 में बजरंगवली मंदिर से मरारी तक ईट सेलिंग एवं पीठसी0सी0 ढलाई का कार्य।", amount: 714400, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2024–25", desc: "ग्राम पंचायत सर्वा के वार्षिक सं0–01 से 04 तक स्ट्रीट लाईट का अध्यक्षपण का कार्य।", amount: 552044, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2024–25", desc: "ग्राम पंचायत सर्वा के वार्षिक सं0–08 में पुस्तकालय के लिए पुस्तक एवं फर्नीचर का क्रय का कार्य।", amount: 450000, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2024–25", desc: "ग्राम पंचायत सर्वा के उच्च माध्यमिक विद्यालय सर्वा के आगे गाइट वॉल के साथ पेयर ब्लॉक निर्माण कार्य।", amount: 987100, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2024–25", desc: "ग्राम पंचायत सर्वा के लालूनगर में सार्वजनिक कुर्आ का जिगोईढ़ार का कार्य।", amount: 74300, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2024–25", desc: "ग्राम पंचायत सर्वा के लालूनगर में सामुदायिक शौचालय का मर्मती कार्य।", amount: 98900, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2025–26", desc: "ग्राम मिर्जापुर में संजीव ढाकी के घर से भीम मांडी के घर तक पीठसी0सी0 ढलाई का कार्य।", amount: 532900, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2025–26", desc: "ग्राम मिर्जापुर के कोडिया आहार में छठ घाट का निर्माण कार्य।", amount: 550600, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2025–26", desc: "ग्राम पंचायत सर्वा में WPU का मर्मती का कार्य।", amount: 129800, status: "पूर्ण" },
    { fund: "15वीं वित्त आयोग", year: "2025–26", desc: "ग्राम सर्वा में खिलु सिंह के खेत से निर्भर सिंह के खेत होते हुए देवन महत्तो के खेत तक ईट सोलिंग एवं पीठसी0सी0 ढलाई का कार्य।", amount: 598400, status: "कार्य प्रगति पर" },
    { fund: "15वीं वित्त आयोग", year: "2025–26", desc: "ग्राम सर्वा में राजीव सिंह के घर से संतोष सिंह के घर तक ढक्कन सहित नाली एवं पीठसी0सी0 ढलाई का कार्य।", amount: 479200, status: "कार्य प्रगति पर" },
    // षष्टम राज्य वित्त (22)
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम सर्वा में रामेश्वर सिंह के खेत से आलोक सिंह के घर तक एवं शंकर सिंह के घर से रामेश्वर सिंह के घर तक मिट्टी भराई खड़ीजकरण एवं पी0सी0सी0 ढलाई कार्य ।", amount: 527400, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा में किसान भवन का जीणांद्वार का कार्य ।", amount: 216500, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के ग्राम मिजापुर के वार्ड सं0–03 में मनोज सिंह के घर से सिपाही जी के घर होते हुए अक्कम महत्ते के घर तक पेवर ब्लॉक सोलिंग एवं नाली निर्माण कार्य ।", amount: 676500, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के वार्ड सं0–11 में हरिजन सामुदायिक भवन का मर्मती कार्य ।", amount: 284200, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम सर्वा में सीलालाल महत्ते के खेत के नजदीक पैन में पुलिया का निर्माण कार्य ।", amount: 289000, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के ग्राम सर्वा में राजो वाब के पास पुलिया का निर्माण कार्य ।", amount: 284100, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम पंचायत सर्वा के ग्राम सर्वा के वार्ड सं0–10 में रामदेव रविदास के घर से ब्रह्मदेव रविदास के घर तक एवं श्यामली दास के घर से सुयादेव दास के घर तक ढक्कन सहित नाली निर्माण कार्य ।", amount: 271300, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2022–23", desc: "ग्राम सर्वा में भैरो स्थान के पास पैन में पुलिया का निर्माण कार्य ।", amount: 289000, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2023–24", desc: "ग्राम पंचायत सर्वा के ग्राम जमालपुर के वार्ड सं0–12 में अपशिष्ट प्रसंस्करण इकाई WPU का निर्माण कार्य ।", amount: 817700, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम सर्वा के वार्ड सं0–06 में नरेश महत्ते के दलान के नजदीक नाला का निर्माण कार्य ।", amount: 615500, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम सर्वा के वार्ड सं0–06 में अनिल सिंह के निकट पैन में पुल का निर्माण कार्य ।", amount: 409100, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम सर्वा के वार्ड सं0–09 में पोसन यादव के घर से काकू यादव के घर तक नाली एवं पी0सी0घी0 ढलाई का निर्माण कार्य ।", amount: 656100, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम पंचायत सर्वा के लालूनगर में छत्तेदार चबुतरा का जीणांद्वार का कार्य ।", amount: 197100, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम सर्वा के वार्ड सं0–06 में सुरेन्द्र पासवान के घर से प्रवीण पासवान के घर तक चंदन पासवान के घर से अनिल पासवान के घर तक पी0सी0सी0 ढलाई एवं नाली निर्माण कार्य ।", amount: 198200, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम मिजापुर में नंदु मांडी के घर से प्रकाश चौधरी के घर तक ढक्कन सहित नाली मर्मती एवं पी0सी0घी0 ढलाई कार्य ।", amount: 387100, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम सर्वा में विष्टरी स्थान से अनुसूचित टोला जाने वाली सड़क तक पी0सी0सी0 ढलाई कार्य ।", amount: 429700, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2024–2025", desc: "ग्राम जमालपुर में भूषण पंडित के घर से रामजी यादव के घर तक एवं अरूण श्रा के घर से वकील साहब के घर तक ढक्कन सहित नाली एवं परमेश्वर पंडित के घर से विजय कुमार के घर तक पी0सी0सी0 ढलाई कार्य ।", amount: 399700, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2025–26", desc: "ग्राम पंचायत सर्वा के ग्राम सर्वा में मेन रोड पर मुख्य द्वार का निर्माण कार्य ।", amount: 507400, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2025–26", desc: "ग्राम पंचायत सर्वा के वार्ड सं0–08 में सामुदायिक भवन का मर्मती कार्य ।", amount: 440100, status: "पूर्ण" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2025–26", desc: "ग्राम सर्वा में लुटन सिंह के घर से अनिल सिंह के घर होते हुए राजेन्द्र सिंह के घर तक पी0सी0घी0 ढलाई कार्य ।", amount: 209700, status: "कार्य प्रगति पर" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2025–26", desc: "ग्राम सर्वा में युजनंदन ठाकुर के घर से अनिल शर्मा के घर तक एवं सत्यनारायण कुमार के घर से रामबृक्ष ठाकुर के घर तक ढक्कन सहित नाली एवं पी0सी0घी0 ढलाई कार्य ।", amount: 109900, status: "कार्य प्रगति पर" },
    { fund: "षष्टम राज्य वित्त आयोग", year: "2025–26", desc: "ग्राम सर्वा में लुटन सिंह के घर से अनिल सिंह के घर होते हुए राजेन्द्र सिंह के घर तक नाली निर्माण कार्य ।", amount: 195600, status: "कार्य प्रगति पर" }
  ];

  // --- ग्लोबल वेरिएबल ---
  let currentSort = { table: null, col: 0, asc: true };
  let chartInstance;

  // --- फॉर्मेटिंग ---
  function formatMoney(n) {
    let [int, frac] = n.toFixed(2).split('.');
    let last = int.slice(-3);
    let rest = int.slice(0, -3);
    if (rest) last = ',' + last;
    return '₹' + rest.replace(/\B(?=(\d{2})+(?!\d))/g, ',') + last + '.' + frac;
  }

  // --- टेबल रेंडर (बिना फिल्टर के भरता है) ---
  function renderTable(tbodyId, data) {
    const tbody = document.getElementById(tbodyId);
    tbody.innerHTML = '';
    data.forEach((s, i) => {
      let cls = s.status === 'पूर्ण' ? 'complete' : 'progress';
      let ico = s.status === 'पूर्ण' ? 'fa-check' : 'fa-clock';
      tbody.innerHTML += `<tr><td>${i+1}</td><td>${s.fund}</td><td>${s.year}</td><td>${s.desc}</td><td class="rupee-cell">${formatMoney(s.amount)}</td><td><span class="status-super ${cls}"><i class="fas ${ico}"></i> ${s.status}</span></td></tr>`;
    });
  }

  // --- मेट्रिक्स अपडेट ---
  function updateMetrics() {
    const total = schemes.length;
    const completed = schemes.filter(s => s.status === 'पूर्ण').length;
    const progress = total - completed;
    const totalAmt = schemes.reduce((a,s)=>a+s.amount,0);
    document.getElementById('totalSchemes').innerText = total;
    document.getElementById('completedSchemes').innerText = completed;
    document.getElementById('progressSchemes').innerText = progress;
    document.getElementById('totalAmount').innerText = formatMoney(totalAmt);
    const perc = ((completed/total)*100).toFixed(1);
    document.getElementById('donutPercent').innerText = perc+'%';
    document.getElementById('completionFraction').innerText = completed+'/'+total;
    document.getElementById('completionPercentBadge').innerText = perc+'%';
    document.getElementById('legendComplete').innerText = completed;
    document.getElementById('legendProgress').innerText = progress;
    document.getElementById('progressFill').style.width = perc+'%';

    const avg = completed ? (schemes.filter(s=>s.status==='पूर्ण').reduce((a,s)=>a+s.amount,0)/completed) : 0;
    const maxS = schemes.reduce((a,b)=>a.amount>b.amount?a:b);
    const minS = schemes.reduce((a,b)=>a.amount<b.amount?a:b);
    const completedAmt = schemes.filter(s=>s.status==='पूर्ण').reduce((a,s)=>a+s.amount,0);
    document.getElementById('quickStats').innerHTML = `
      <div class="stat-row"><span>औसत पूर्ण</span> <strong>${formatMoney(avg)}</strong></div>
      <div class="stat-row"><span>अधिकतम</span> <strong>${formatMoney(maxS.amount)}</strong></div>
      <div class="stat-row"><span>न्यूनतम</span> <strong>${formatMoney(minS.amount)}</strong></div>
      <div class="stat-row"><span>कुल पूर्ण</span> <strong>${formatMoney(completedAmt)}</strong></div>
    `;
  }

  // --- चार्ट बनाना ---
  function renderChart() {
    const years = [...new Set(schemes.map(s => s.year))];
    const counts = years.map(y => schemes.filter(s => s.year === y).length);
    const ctx = document.getElementById('yearChart').getContext('2d');
    if (chartInstance) chartInstance.destroy();
    chartInstance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: years,
        datasets: [{
          label: 'कार्यों की संख्या',
          data: counts,
          backgroundColor: '#1f7cb4',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true, grid: { color: '#c0d4e8' } } }
      }
    });
  }

  // --- फिल्टर फंक्शन (सर्च + स्टेटस + ईयर) ---
  function filterData() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.querySelector('.pill.active')?.getAttribute('data-filter') || 'all';
    const yearFilter = document.getElementById('yearFilter').value;
    const filtered = schemes.filter(s => {
      const matchSearch = s.desc.toLowerCase().includes(search) || s.fund.toLowerCase().includes(search);
      const matchStatus = statusFilter === 'all' ? true : (statusFilter === 'complete' ? s.status === 'पूर्ण' : s.status === 'कार्य प्रगति पर');
      const matchYear = yearFilter === 'all' ? true : s.year === yearFilter;
      return matchSearch && matchStatus && matchYear;
    });
    const f15 = filtered.filter(s => s.fund === '15वीं वित्त आयोग');
    const fState = filtered.filter(s => s.fund === 'षष्टम राज्य वित्त आयोग');
    renderTable('table15Body', f15);
    renderTable('tableStateBody', fState);
    document.getElementById('footer15Total').innerText = formatMoney(f15.reduce((a,s)=>a+s.amount,0));
    document.getElementById('footerStateTotal').innerText = formatMoney(fState.reduce((a,s)=>a+s.amount,0));
    document.getElementById('badge15').innerText = f15.length + ' कार्य';
    document.getElementById('badgeState').innerText = fState.length + ' कार्य';
  }

  // --- सॉर्ट फंक्शन (अब क्रमांक भी ठीक करता है) ---
  function sortTable(col, tableId) {
    const tbodyId = tableId === '15' ? 'table15Body' : 'tableStateBody';
    const tbody = document.getElementById(tbodyId);
    const rows = Array.from(tbody.rows);
    const asc = currentSort.table === tableId && currentSort.col === col ? !currentSort.asc : true;
    currentSort = { table: tableId, col, asc };
    rows.sort((a,b) => {
      let aVal = a.cells[col].innerText;
      let bVal = b.cells[col].innerText;
      if (col === 4) { // राशि
        aVal = parseFloat(aVal.replace(/[^0-9.]/g,''));
        bVal = parseFloat(bVal.replace(/[^0-9.]/g,''));
      }
      if (asc) return aVal > bVal ? 1 : -1;
      else return aVal < bVal ? 1 : -1;
    });
    tbody.innerHTML = '';
    rows.forEach((r, idx) => {
      r.cells[0].innerText = idx + 1;   // क्रमांक सही करें
      tbody.appendChild(r);
    });
  }

  // --- सभी टेबल भरना (शुरूआत) ---
  function fillTables() {
    const s15 = schemes.filter(s => s.fund === '15वीं वित्त आयोग');
    const sState = schemes.filter(s => s.fund === 'षष्टम राज्य वित्त आयोग');
    renderTable('table15Body', s15);
    renderTable('tableStateBody', sState);
    document.getElementById('footer15Total').innerText = formatMoney(s15.reduce((a,s)=>a+s.amount,0));
    document.getElementById('footerStateTotal').innerText = formatMoney(sState.reduce((a,s)=>a+s.amount,0));
    document.getElementById('badge15').innerText = s15.length + ' कार्य';
    document.getElementById('badgeState').innerText = sState.length + ' कार्य';
  }

  // --- एक्सपोर्ट CSV ---
  function exportCSV() {
    let csv = "क्र.,मद,वित्त वर्ष,योजना का नाम,राशि,स्थिति\n";
    schemes.forEach((s,i) => {
      csv += `${i+1},"${s.fund}","${s.year}","${s.desc.replace(/"/g,'""')}",${s.amount},"${s.status}"\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'panchayat_sarva_data.csv';
    a.click();
  }

  // --- एक्सपोर्ट PDF (सिंपल) ---
  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text('ग्राम पंचायत सर्वा - कार्य सूची', 10, 10);
    let y = 20;
    schemes.slice(0, 20).forEach((s,i) => {
      doc.text(`${i+1}. ${s.fund} (${s.year}) - ${s.desc.substring(0,50)}...`, 10, y);
      y += 7;
    });
    doc.save('panchayat_sarva.pdf');
  }

  // --- डार्क मोड टॉगल ---
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const btnIcon = document.querySelector('.commission-tag i');
    if (btnIcon) {
      btnIcon.classList.toggle('fa-moon');
      btnIcon.classList.toggle('fa-sun');
    }
    // चार्ट का रंग डार्क मोड में बदलें (सिंपल तरीका)
    renderChart(); 
  }

  // --- इवेंट लिसनर ---
  document.getElementById('searchInput').addEventListener('input', filterData);
  document.getElementById('yearFilter').addEventListener('change', filterData);
  document.querySelectorAll('.pill').forEach(p => {
    p.addEventListener('click', function() {
      document.querySelectorAll('.pill').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      filterData();
    });
  });

  // --- इनिशियलाइज़ ---
  fillTables();
  updateMetrics();
  renderChart();
  window.sortTable = sortTable;
  window.exportCSV = exportCSV;
  window.exportPDF = exportPDF;
  window.toggleDarkMode = toggleDarkMode;
</script>
</body>
</html>